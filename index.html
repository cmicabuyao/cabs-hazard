<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/png" href="logo3.png">
  <title>CABS-HAZARDS v.1.3.</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- Basic styles -->
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:'Poppins',sans-serif;
      background:#222;color:#fff;overflow:hidden;
    }

    /* Loading screen */
    #loading-screen{
      position:fixed;inset:0;
      display:flex;align-items:center;justify-content:center;
      z-index:99999;background:rgba(0,0,0,0.75);
    }
    .loading-content{text-align:center;color:#fff}
    .loading-title{font-size:2.2rem;font-weight:700;margin-bottom:-2px}
    .loading-bio{font-size:13px;opacity:.9;margin-bottom:10px}
    .progress-container{width:280px;height:18px;background:rgba(255,255,255,0.12);border-radius:20px;overflow:hidden;margin:0 auto}
    #progress-bar{height:100%;width:0%;border-radius:20px;background:linear-gradient(90deg, #2196f3, #e91e63);transition:width 0.5s linear}
    #progress-text{margin-top:10px;font-weight:700}

    /* Sidebar */
    #sidebar{
      position:fixed;left:0;top:0;height:100%;width:320px;
      padding:20px 25px;background:rgba(30,30,30,0.95);z-index:20;transition:left .35s ease;
    }
    #sidebar.hide{left:-340px}
    #sidebar h1{display:flex;gap:10px;align-items:center;font-size: 20px;}
    #sidebar h1 img{width:40px;height:40px;object-fit:contain}
    #sidebar p{opacity:.85;margin:3px 0 10px}
    .time-box{background:#d32f2f;color:#fff;padding:10px;border-radius:6px;margin-bottom:12px;text-align:center;font-weight:900}
    .time-box .date{opacity:.9;font-size:15px;margin-top:1px}
    .menu-section{margin-top:05px}
    /* header titles (no arrow icon) */
    .menu-section h3{
      font-size:15px;padding:8px 10px;border-radius:6px;background:rgba(255,255,255,0.03);
      display:block;cursor:pointer;margin-bottom:4px;
    }
    /* compact submenu: no extra gaps, left-aligned with parent */
    .menu-section ul{list-style:none;margin:0;padding:0 0 6px 0;display:none}
    .menu-section ul.open{display:block}
    .menu-section li{margin:4px 0}
    .menu-section a{
      display:block;padding:6px 10px;border-radius:6px;text-decoration:none;color:#fff;opacity:.95;
    }
    .menu-section a:hover{background:rgba(255,255,255,0.03);text-decoration:none}
    .menu-section a.active{background:rgba(255,255,255,0.06);font-weight:700}

    /* Toggle button */
    #toggleBtn{
      position:fixed;right:25px;bottom:25px;width:55px;height:55px;border-radius:50%;
      background:#fff;color:#111;border:none;z-index:30;font-size:26px;cursor:pointer;box-shadow:0 6px 18px rgba(0,0,0,.35)
    }
    #toggleBtn:hover{background:#aa00ff;color:#fff}

    /* iframe container */
    #map-frame{position:fixed;right:0;top:0;left:320px;height:100vh;width:calc(100% - 320px);border:0;z-index:5;transition:left .35s ease,width .35s ease}
    #sidebar.hide ~ #map-frame{left:0;width:100%}

    /* Responsive */
    @media (max-width:768px){
      #sidebar{width:260px;padding:18px}
      #map-frame{left:260px;width:calc(100% - 260px)}
      #sidebar.hide ~ #map-frame{left:0;width:100%}
      #toggleBtn{right:16px;bottom:16px}
    }

    /* small footer text in menu */
    .muted{font-size:12px;opacity:.7;margin-top:12px}
  </style>
</head>
<body>

  <!-- Loading screen -->
  <div id="loading-screen" aria-hidden="false">
    <div class="loading-content">
      <div class="loading-title">CABS-HAZARDS v.1.3.</div>
      <div class="loading-bio">A Meteorological & Geological Hazards Map <br> for City of Cabuyao. <strong>Please wait loading the data files!</strong></div>
      <div class="progress-container">
        <div id="progress-bar"></div>
      </div>
      <div id="progress-text">0%</div>
    </div>
  </div>

  <!-- Sidebar -->
  <aside id="sidebar">
    <h1><img src="logo3.png" alt="logo"> CABS-HAZARDS</h1>
    <p>A Meteorological & Geological Hazards Map for City of Cabuyao</p>

    <div class="time-box">
      <div id="time">--:--:--</div>
      <div class="date" id="date">Loading...</div>
    </div>

    <nav class="menu-section" aria-label="Menu">
      <h3>WEATHER</h3>
      <ul>
        <li><a href="#" data-src="https://cwicabuyao.github.io/cabs-hazard/data-map/weather/daily">Daily Weather</a></li>
        <li><a href="#" data-src="https://cwicabuyao.github.io/cabs-hazard/data-map/weather/observed">Weather Observed</a></li>
        <li><a href="#" data-src="https://cwicabuyao.github.io/cabs-hazard/data-map/weather/outlook">03-Days Weather Outlook</a></li>
        <li><a href="#" data-src="https://cwicabuyao.github.io/cabs-hazard/data-map/climate/tc-active">Active Tropical Cyclone</a></li>
        <li><a href="#" data-src="https://cwicabuyao.github.io/cabs-hazard/data-map/climate/tc-forecast">Tropical Cyclone Forecast</a></li>
        <li><a href="#" data-src="https://cwicabuyao.github.io/cabs-hazard/data-map/climate/tc-formation">Tropical Cyclone Formation</a></li>
        <li><a href="#" data-src="https://cwicabuyao.github.io/cabs-hazard/data-map/weather/satellite">Satellite Imagery</a></li>
        <li><a href="#" data-src="https://cwicabuyao.github.io/cabs-hazard/data-map/weather/radar">Radar</a></li>
      </ul>

      <h3>CLIMATE</h3>
      <ul>
        <li><a href="#" data-src="https://cwicabuyao.github.io/cabs-hazard/data-map/climate/rainfall">Rainfall Accumulated</a></li>
        <li><a href="#" data-src="https://cwicabuyao.github.io/cabs-hazard/data-map/climate/wind">Wind Accumulated</a></li>
        <li><a href="#" data-src="https://cwicabuyao.github.io/cabs-hazard/data-map/climate/temperature">Temperature Accumulated</a></li>
        <li><a href="#" data-src="https://cwicabuyao.github.io/cabs-hazard/data-map/climate/enso">ENSO</a></li>
      </ul>

      <h3>HYDROLOGICAL</h3>
      <ul>
        <li><a href="#" data-src="https://cwicabuyao.github.io/cabs-hazard/data-map/hydrological/advisory">Flood Advisory</a></li>
        <li><a href="#" data-src="https://cwicabuyao.github.io/cabs-hazard/data-map/hydrological/reported">Flooding Reported</a></li>
        <li><a href="#" data-src="https://cwicabuyao.github.io/cabs-hazard/data-map/hydrological/hazard">Flooding Hazards</a></li>
        <li><a href="#" data-src="https://cwicabuyao.github.io/cabs-hazard/data-map/hydrological/river">River Basin</a></li>
        <li><a href="#" data-src="https://cwicabuyao.github.io/cabs-hazard/data-map/hydrological/wave">Laguna De Bay Current Wave</a></li>
      </ul>

      <h3>EARTHQUAKE</h3>
      <ul>
        <li><a href="#" data-src="https://cwicabuyao.github.io/cabs-hazard/data-map/earthquake/phivocs/latest">DOST-PHIVOCS Seismic Map</a></li>
        <li><a href="#" data-src="https://cwicabuyao.github.io/cabs-hazard/data-map/earthquake/usgs/latest">USGS Seismic Map</a></li>
        <li><a href="#" data-src="https://cwicabuyao.github.io/cabs-hazard/data-map/earthquake/hazard">Intensity Hazard Map</a></li>
        <li><a href="#" data-src="https://cwicabuyao.github.io/cabs-hazard/data-map/earthquake/fault">West Valley Fault: City of Cabuyao</a></li>
      </ul>

      <h3>ACCOUNT</h3>
      <ul>
        <li><a href="#" data-src="https://cwicabuyao.github.io/cabs-hazard/login">Login</a></li>
        <li><a href="#" data-src="https://cwicabuyao.github.io/cabs-hazard/register">Register</a></li>
        <li><a href="#" data-src="https://cwicabuyao.github.io/cabs-hazard/about">About</a></li>
        <li><a href="#" data-src="https://cwicabuyao.github.io/cabs-hazard/donate">Donate</a></li>
        <p class="muted"><strong>EXCLUSIVE FOR OFFICIAL MEMBERS ONLY, AND LGU CAN SET UP AN ACCOUNT.</strong> Some features and data have privacy settings that restrict viewing.</p>
      </ul>
    </nav>

    <p style="margin-top:14px;opacity:.9;font-size:13px">
      <strong>CABS-HAZARD</strong> is a dynamic meteorological and geological hazard map developed by cwi_cabuyao to provide fast, reliable updates on weather, climate and earthquake risks. It helps residents stay informed, aware, and prepared against potential hazards in City of Cabuyao.
    </p>
  </aside>
  
  <!-- Toggle button -->
  <button id="toggleBtn" aria-label="Toggle menu">â˜°</button>

  <!-- Main iframe: initial src is MapTiler as requested -->
  <iframe id="map-frame" src="https://cwicabuyao.github.io/cabs-hazard/main">php</iframe>

  <!-- Scripts -->
  <script>
    /* Loading progress simulation (approx 6s) */
    (function(){
      const screen = document.getElementById('loading-screen');
      const bar = document.getElementById('progress-bar');
      const txt = document.getElementById('progress-text');
      let p = 0;
      const t = setInterval(()=>{
        p += 0.8; if(p>100) p = 100;
        bar.style.width = p + '%';
        txt.textContent = Math.round(p) + '%';
        if(p >= 100){
          clearInterval(t);
          setTimeout(()=> {
            screen.style.transition = 'opacity .6s ease';
            screen.style.opacity = 0;
            setTimeout(()=> screen.style.display = 'none', 600);
          }, 250);
        }
      }, 60);
    })();

    /* Time & Date (Asia/Manila) */
    (function(){
      function update(){
        const now = new Date();
        const timeOpts = { timeZone:'Asia/Manila', hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:true };
        const dateOpts = { timeZone:'Asia/Manila', day:'numeric', month:'long', year:'numeric' };
        document.getElementById('time').textContent = now.toLocaleTimeString('en-US', timeOpts);
        document.getElementById('date').textContent = now.toLocaleDateString('en-US', dateOpts);
      }
      update();
      setInterval(update,1000);
    })();

    /* Sidebar toggle */
    (function(){
      const sidebar = document.getElementById('sidebar');
      const toggle = document.getElementById('toggleBtn');
      toggle.addEventListener('click', ()=> sidebar.classList.toggle('hide'));
    })();

    /* Collapsible sections (single-open accordion; clicking same header toggles close) */
    (function(){
      const headers = Array.from(document.querySelectorAll('.menu-section h3'));
      headers.forEach(header => {
        header.addEventListener('click', () => {
          const ul = header.nextElementSibling;
          if(!ul) return;

          // If this section is already open -> close it
          if (ul.classList.contains('open')) {
            ul.classList.remove('open');
            return;
          }

          // Otherwise close all sections, then open this one
          document.querySelectorAll('.menu-section ul').forEach(u => u.classList.remove('open'));
          ul.classList.add('open');
        });
      });
    })();

    /* Menu links: change iframe src instead of opening new tab */
    (function(){
      const iframe = document.getElementById('map-frame');

      // helper to set active link styles
      function setActiveLink(link){
        document.querySelectorAll('.menu-section a').forEach(a => a.classList.remove('active'));
        if(link) link.classList.add('active');
      }

      // add click handlers to all menu anchors that have data-src
      document.querySelectorAll('.menu-section a[data-src]').forEach(a=>{
        a.addEventListener('click', function(ev){
          ev.preventDefault();
          const src = this.getAttribute('data-src');
          if(!src) return;
          // set iframe src
          iframe.src = src;
          // mark active
          setActiveLink(this);
          // collapse sidebar on small screens for better view
          const sidebar = document.getElementById('sidebar');
          if(window.innerWidth <= 768) sidebar.classList.add('hide');
        });
      });

      // Optionally, mark the initial active item if it matches the initial iframe src
      (function markInitial(){
        const initial = iframe.getAttribute('src') || '';
        const links = Array.from(document.querySelectorAll('.menu-section a[data-src]'));
        const match = links.find(l => l.getAttribute('data-src') && initial.includes(l.getAttribute('data-src')));
        if(match) setActiveLink(match);
      })();
    })();
  </script>
</body>
</html>
