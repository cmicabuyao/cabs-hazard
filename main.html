<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Himawari Satellite</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    html, body { height: 100%; margin: 0; background: #000000; }
    #map { width: 100%; height: 100%; }
    .info {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 9999;
      background: rgba(255,255,255,0.9);
      padding: 6px 10px;
      border-radius: 6px;
      font-family: system-ui, sans-serif;
      font-size: 14px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }
    /* BAGONG DARK MODE STYLE PARA SA CONTROLS PANEL */
    .controls {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 9999;
      background: rgba(40, 40, 40, 0.95); /* Darker background */
      color: #ffffff; /* White text */
      padding: 10px;
      border-radius: 6px;
      font-family: system-ui, sans-serif;
      font-size: 14px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.6);
      width: 200px;
      /* Smooth transition */
      transition: opacity 0.3s, visibility 0.3s;
    }
    .controls input[type="range"] {
        width: 100%;
    }
    .controls label {
      display: block;
      margin-top: 5px;
    }

    /* Style para sa Close/Exit Button */
    .controls-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 5px;
    }
    .close-btn {
        background: none;
        border: none;
        color: #fff;
        font-size: 20px;
        cursor: pointer;
        line-height: 1;
        padding: 0;
        margin: 0;
        opacity: 0.7;
    }
    .close-btn:hover {
        opacity: 1;
    }

    /* Style para sa Adjust Logo/Button */
    .adjust-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        z-index: 9998; /* Ilagay sa likod ng controls panel */
        background: rgba(40, 40, 40, 0.8);
        border: 1px solid #ffffff33;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
        box-shadow: 0 2px 6px rgba(0,0,0,0.6);
        transition: background 0.2s, opacity 0.2s;
        /* Itago sa simula */
        opacity: 0;
        visibility: hidden;
    }
    .adjust-btn:hover {
        background: rgba(60, 60, 60, 0.9);
    }
    /* Simple SVG Icon (Settings/Gear icon) */
    .adjust-btn svg {
        fill: white;
        width: 20px;
        height: 20px;
    }

    .leaflet-image-layer { 
        transition: filter 0.1s linear, opacity 0.1s linear; 
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <div class="controls" id="controlsPanel">
    <div class="controls-header">
        <p style="margin: 0; font-weight: bold;">*Color Adjustments</p>
        <button class="close-btn" onclick="toggleControls()">x</button>
    </div>

    <label for="contrast">Contrast: <span id="contrastValue">100%</span></label>
    <input type="range" id="contrast" min="0" max="300" value="175">

    <label for="brightness">Brightness: <span id="brightnessValue">100%</span></label>
    <input type="range" id="brightness" min="0" max="200" value="100">

    <label for="opacity">Opacity: <span id="opacityValue">50%</span></label>
    <input type="range" id="opacity" min="0" max="100" value="38">
  </div>
  <button class="adjust-btn" id="adjustButton" onclick="toggleControls()">
    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 8c2.21 0 4 1.79 4 4s-1.79 4-4 4-4-1.79-4-4 1.79-4 4-4zm-7 7H3V9h2v6zm13-6v6h2V9h-2zm-7-2v2H9V7h2zm0 8v2H9v-2h2zM7.83 6.34l1.42 1.42L6.41 9.5l-1.42-1.42 2.84-1.74zm10.74 1.74l-1.42 1.42 2.84 1.74 1.42-1.42-2.84-1.74zm-3.59-1.42l-1.42 1.42-1.74-2.84 1.42-1.42 1.74 2.84zm-4.74 7.08l1.42 1.42-2.84 1.74-1.42-1.42 2.84-1.74z"/>
    </svg>
  </button>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    // **GEOJSON PLACEHOLDER** (Dapat palitan ng totoong data kung gagamitin ang border)
    const philippinesGeoJSON = {
      "type": "FeatureCollection",
      "features": []
    };
    
    // CENTER sa Cabuyao, Laguna
    const map = L.map('map', {
      center: [14.2233, 121.1250], 
      zoom: 11,
      minZoom: 7,
      maxZoom: 30
    });

    // Base map â€” Dark Style
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
      attribution: '&copy;JMA-MSC Data Process by CWI-CABUYAO Servers, OpenStreetMap',
      subdomains: 'abcd',
      maxZoom: 19
    }).addTo(map);

    // Himawari overlay link
    const himawariUrl = "https://realearth.ssec.wisc.edu/api/image?products=HIMAWARI-B03.-100,HIMAWARI-B13-GRAD.100,HIMAWARI-true-color.-100,NESDIS-GHE-HourlyRainfall.-100&width=480&height=278&client=RealEarth&basemap=-&labels=-&center=14.136527770028032,121.56605072945429&zoom=5&timeproduct=HIMAWARI-B03&timespan=-12t&animate=true&animationspeed=85"

    // Overlay bounds
    const bounds = [
      [  8.0, 110.12 ], 
      [  20.0, 133.00 ]  
    ];

    // Add overlay
    const himawariOverlay = L.imageOverlay(himawariUrl, bounds, {
      opacity: 0.50,
      interactive: false
    }).addTo(map);

    // Idagdag ang GeoJSON layer (kung may data)
    if (philippinesGeoJSON.features.length > 0) {
        L.geoJSON(philippinesGeoJSON, {
            style: {
                color: "white",
                weight: 1,
                opacity: 1,
                fillOpacity: 0
            }
        }).addTo(map);
    }
    
    // BAGONG FUNCTIONALITY: TOGGLE CONTROLS at IMAGE ADJUSTMENTS
    const controlsPanel = document.getElementById('controlsPanel');
    const adjustButton = document.getElementById('adjustButton');
    
    const contrastSlider = document.getElementById('contrast');
    const brightnessSlider = document.getElementById('brightness');
    const opacitySlider = document.getElementById('opacity');
    const contrastValueSpan = document.getElementById('contrastValue');
    const brightnessValueSpan = document.getElementById('brightnessValue');
    const opacityValueSpan = document.getElementById('opacityValue');
    
    let himawariImageElement = null;
    
    // Default state: Ang panel ay nakikita (visible) sa simula
    let isPanelVisible = true;

    function toggleControls() {
        if (isPanelVisible) {
            // Itago ang panel
            controlsPanel.style.opacity = '0';
            controlsPanel.style.visibility = 'hidden';
            // Ipakita ang adjust button
            adjustButton.style.opacity = '1';
            adjustButton.style.visibility = 'visible';
        } else {
            // Ipakita ang panel
            controlsPanel.style.opacity = '1';
            controlsPanel.style.visibility = 'visible';
            // Itago ang adjust button
            adjustButton.style.opacity = '0';
            adjustButton.style.visibility = 'hidden';
        }
        isPanelVisible = !isPanelVisible;
    }

    himawariOverlay.on('load', function () {
        himawariImageElement = himawariOverlay.getElement();
        updateImageStyle(); 
    });

    function updateImageStyle() {
      if (!himawariImageElement) return;

      const contrast = contrastSlider.value / 100;
      const brightness = brightnessSlider.value / 100;
      const opacity = opacitySlider.value / 100;

      const filterStyle = `contrast(${contrast}) brightness(${brightness})`;
      
      himawariImageElement.style.filter = filterStyle;
      himawariImageElement.style.opacity = opacity;

      contrastValueSpan.textContent = `${contrastSlider.value}%`;
      brightnessValueSpan.textContent = `${brightnessSlider.value}%`;
      opacityValueSpan.textContent = `${opacitySlider.value}%`;
    }

    // Listener para sa bawat slider
    contrastSlider.addEventListener('input', updateImageStyle);
    brightnessSlider.addEventListener('input', updateImageStyle);
    opacitySlider.addEventListener('input', updateImageStyle);
    
    // Tiyakin na ang default style ay na-apply
    updateImageStyle(); 

    // Auto-refresh logic
    const refreshInterval = 180000; 
    setInterval(() => {
      himawariOverlay.setUrl(`${himawariUrl}?t=${Date.now()}`);
      console.log("Himawari image refreshed:", new Date().toLocaleTimeString("en-PH", { timeZone: "Asia/Manila" }));
      setTimeout(updateImageStyle, 500); 
    }, refreshInterval);
  </script>
</body>
</html>